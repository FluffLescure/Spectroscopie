\documentclass[11pt]{book}

\input{../.style.tex}

\input{../.math.tex}

\input{../.header.tex}
	\pagestyle{fancy}
	\fancyhf{}
	\fancyhead[RE, LO]{\textbf{Etude d'un réseau Ethernet}}
	\fancyfoot[LE, RO]{\textbf{Page \thepage}}
	\fancyfoot[LO, RE]{\text{\rightmark}}
	
\input{../.toc.tex}

% figure support
\usepackage{import}
\usepackage{xifthen}
\pdfminorversion=7
\usepackage{pdfpages}
\usepackage{transparent}
\newcommand{\incfig}[1]{%
	\def\svgwidth{\columnwidth}
	\import{./figures/}{#1.pdf_tex}
}

\pdfsuppresswarningpagegroup=1

\usepackage{array}

\begin{document}
	% Spacing 
	\input{../.begin.tex}

	%Cover
	\input{../.cover.tex}

	\section{Réalisation de la Topologie Réseau}

	En utilisant le logiciel Filius on réalise le montage suivant:
	\begin{figure}[ht!]
		\centering
		\includegraphics[width=0.8\textwidth]{./object/g1.png}
		\caption{Montage du réseau sur Filius}
	\end{figure}

	Ensuite on configure l'adresse IP de deux ordinateur, l'un sur \texttt{192.168.0.1} et l'autre sur \texttt{192.168.0.2}. En passant en mode simulation on ouvre le \texttt{PC2} et après avoir installé la ligne de commande on rentre les commandes suivantes : \texttt{ipconfig}, \texttt{arp -a} et \texttt{route}.
	\begin{items}{-15pt}{-10pt}
		\item \texttt{ipconfig} : Permet de regarder la configuration et les propriétés de la connexion de l'ordinateur sur le réseau
		\item \texttt{arp -a} : Permet de lister la table ARP de l'ordinateur
		\item \texttt{route} : Permet d'afficher la table de routage de l'ordinateur.
	\end{items}
	\begin{figure}[ht!]
	\minipage{0.32\textwidth}
	\adjustbox{width=0.95\textwidth}{
		\begin{tabular}{ l  l }
			Adresse IP  & : 192.168.0.2 \\
			Masque & : 255.255.255.0 \\
			Adresse MAC & : 24:CC:B6:3B:D6:C1 \\
			Passerelle & : 192.168.0.254 \\
			Serveur DNS & : 194.214.191.100			
		\end{tabular}
	}
	\endminipage\hfill
	\minipage{0.32\textwidth}
	\adjustbox{width=0.9\textwidth}{
		\begin{tabular}{ |c | c| }
			\hline
			Adresse IP  & Adresse Mac \\
			\hline
			255.255.255.255 & FF:FF:FF:FF:FF:FF \\
			\hline		
		\end{tabular}
	}
	\endminipage\hfill
	\minipage{0.32\textwidth}
	\adjustbox{width=0.95\textwidth}{
		\begin{tabular}{ |l | l| l| }
			\hline
			Destination & Masque & Passerelle\\
			\hline
			192.168.0.2 & 255.255.255.255 & 127.0.0.1 \\
			\hline		
			192.168.0.0 & 255.255.255.0 & 192.168.0.2\\
			\hline
			127.0.0.0 & 255.0.0.0 & 127.0.0.1\\
			\hline
			0.0.0.0 & 0.0.0.0 & 192.168.0.254\\
			\hline
		\end{tabular}
	}
	\endminipage\hfill
	\caption{Configuration IP, Table ARP et Table Routage}	
	\end{figure}
	
	Pour l'instant on voit que l'ordinateur est configuré avec l'IP correspondante. Sa table ARP ne contient que l'adresse IP et MAC du broadcast, autrement dit elle ne contient pas les adresses MAC d'autres ordinateurs sur le réseau. Finalement sa Table de routage nous indique que pour des trames dirigées à sa propre adresse utiliseras la passerelle locale, celles dirigées à un appareil sur le réseau seront envoyé à partir de la carte réseau et tout le reste sera redirigé ver l'adresse \texttt{192.168.0.254}.

	On effectue un ping entre l'ordinateur 2 et l'ordinateur 1, les échanges figurant ci-dessous:

	\begin{figure}[ht!]
		\begin{tabular}{|l|l|l|l|l|l|l|}
			\hline
			No. & Date & Source & Destination & Protocole & Couche & Commentaire\\
			\hline
			1 & 21:26:38:286 & 192.168.0.2 & 192.168.0.1 & ARP & Internet & Recherche MAC associée à 192.168.0.1\\
			\hline
			2 & 21:26:39:005 & 192.168.0.2 & 192.168.0.1 & ARP & Internet & Recherche MAC associée à 192.168.0.1\\
			\hline
			3 & 21:26:39:007 & 192.168.0.2 & 192.168.0.1 & ARP & Internet & Recherche MAC associée à 192.168.0.1\\
			\hline
			
		\end{tabular}
		\caption{Échange de Trames sans requête ARP}
	\end{figure}

	\begin{figure}[ht!]
		\begin{tabular}{|l|l|l|l|l|l|l|}
			\hline
			No. & Date & Source & Destination & Protocole & Couche & Commentaire\\
			\hline
			1 & 21:26:39:007 & 192.168.0.2 & 192.168.0.1 & ICMP & Internet & Echo Request (ping), TTL: 64, Seq.-No.: 1\\
			\hline
			2 & 21:26:39:532 & 192.168.0.1 & 192.168.0.2 & ICMP & Internet & Echo Reply (pong), TTL: 64, Seq.-No.: 1\\
			\hline
			  & & & \vdots & & & \\
			\hline
			8 & 21:26:42:049 & 192.168.0.1 & 192.168.0.2 & ICMP & Internet & Echo Reply (pong), TTL: 64, Seq.-No.: 4\\
			\hline
			
		\end{tabular}
		\caption{Échange de Trames sans requête ARP}
	\end{figure}
	\newpage
	On voit donc qu'une fois le premier ping et effectué entre les deux machine, l'ordinateur n'émet pas de requête ARP. Si nous regardons sa table ARP on retrouve :
	\begin{figure}[ht!]
		\centering
		\begin{tabular}{|c|c|}
			\hline
			Adresse IP & Adresse MAC\\
			\hline
			192.168.0.1 & F5:46:A5:C9:61:1C\\
			\hline
			255.255.255.255 & FF:FF:FF:FF:FF:FF\\
			\hline
		\end{tabular}
		\caption{Table ARP de l'ordinateur 2}
	\end{figure}
	
	On voit que l'adresse MAC de l'ordinateur 1 a été enregistrée dans la table ARP de l'ordinateur. Ceci explique pourquoi il n'a donc pas besoin de refaire une requête ARP; il connait déjà l'adresse MAC qui correspond à l'ordinateur 1.

	Q5. 

	\section{Mise en place du DHCP}

	On configure le \texttt{PC1} en tant que serveur DHCP avec une plage de \texttt{192.168.0.100} à \texttt{192.168.0.150}. Et on met le \texttt{PC3} en mode adressage automatique par serveur DHCP. Après la simulation on obtient observe les trames échangés:

	\begin{figure}[ht!]
		\centering
		\adjustbox{width=0.95\textwidth}{
		\begin{tabular}{|l|l|l|l|l|l|l|}
			\hline
			No. & Date & Source & Destination & Protocole & Couche & Commentaire\\
			\hline
			1 & 23:22:18.367 & 0.0.0.0:68 & 255.255.255.255:67 & DHCP & Application & DHCPDISCOVER yiaddr=0.0.0.0 chaddr=DB:43:7A:8E:3C:05\\
			\hline
			2 & 23:22:18:710 & 192.168.0.1:67 & 255.255.255.255:68 & DHCP & Application & DHCPOFFER yiaddr=192.168.0.100 chaddr=DB:43:7A:8E:3C:05\\
			\hline
			3 & 23:22:18.711 & 0.0.0.0 & 192.168.0.100 & ARP & Internet & Recherche MAC associée à 192.168.0.100\\
			\hline
			4 & 23:22:19.962 & 0.0.0.0 & 192.168.0.100 & ARP & Internet & Recherche MAC associée à 192.168.0.100\\
			\hline
			5 & 23:22:21.212 & 0.0.0.0:68 & 255.255.255.255:67 & DHCP & Application & DHCPREQUEST yiaddr=0.0.0.0 chaddr=DB:43:7A:8E:3C:05\\
			\hline
			6 & 23:22:21.520 & 192.168.0.1:67 & 255.255.255.255:68 & DHCP & Application & DHCPACK yiaddr=192.168.0.100 chaddr=DB:43:7A:8E:3C:05\\
			\hline
		\end{tabular}
	}
	\end{figure}

	Quand le \texttt{PC3} se connecte au réseau, envoi à l'IP de broadcast une découverte de serveur DHCP. Quand cette trame parvient au serveur il retourne aussi en broadcast une offre d'adresse IP et de passerelle. Le \texttt{PC3}vérifie ensuite que cette adresse ne soit pas occupée pas quelqu'un en envoyant une requête ARP à l'adresse IP qui lui est offerte. Quand il n'y a pas de réponse alors elle envoi une demande au serveur DHCP pour s'assigner l'adresse IP qui lui est offerte. Et après confirmation du serveur DHCP il modifie alors les configurations de sa connexion sur le réseau. 

	D'après ce tableau on peut donc bien voir que l'adresse qui lui est automatiquement affectée est la première dans la plage d'adresse : \texttt{192.168.0.100}. 

	\newpage

	\section{Configuration du Routeur}

	\begin{figure}[ht!]
		\centering
		\begin{tabular}{|c|c|c|c|}
			\hline
			IP de Destination & Masque & Passerelle & Interface\\
			\hline
			194.214.131.254 & 255.255.255.255 & 127.0.0.1 & 127.0.0.1\\
			\hline
			192.168.0.254 & 255.255.255.255 & 127.0.0.1 & 127.0.0.1\\
			\hline
			194.214.131.0 & 255.255.255.0 & 194.214.131.254 & 194.214.131.254\\
			\hline
			192.168.0.0 & 255.255.255.0 & 192.168.0.254 & 192.168.0.254\\
			\hline
			127.0.0.0 & 255.0.0.0 & 127.0.0.1 & 127.0.0.1\\
			\hline
		\end{tabular}
		\caption{Table de routage du routeur}
	\end{figure}

	Si un trame est à destination du router, c'est à dire avec l'IP \texttt{192.214.131.254} ou \texttt{192.168.0.254} alors le routeur utilise son interface et passerelle locale, il lit les trames qui lui sont destinés. Si une trame s'adresse à un appareil sur un deux deux réseaux alors il route cette trame vers le réseau correspondant en utilisant l'interface adequate. Et dernièrement s'il se parle a lui même il utilise sa passerelle et interface locale.
	
	On envoi maintenant un ping depuis le \texttt{PC2} au portable. On relève les trames suivantes:

	\begin{figure}[!ht]
		\centering
		\adjustbox{width=\textwidth}{
		\begin{tabular}{|l|l|l|l|l|l|l|l|}
			\hline
			No. & MAC Destination & MAC Source & IP Source & IP Destination & Protocole & Couche & Commentaire\\
			\hline
			1 & FF:FF:FF:FF:FF:FF & C2:FD:5A:E8:60:E5 & 192.168.0.2 & 192.168.0.254 & ARP & Internet & Requête ARP\\
			\hline
			2 & C2:FD:5A:E8:60:E5 & EF:36:DE:39:06:86 & 192.168.0.254 & 192.168.0.2 & ARP & Internet & Réponse ARP\\
			\hline
			3 & E8:36:DE:39:06:86 & C2:FD:5A:E8:60:E5 & 192.168.0.2 & 194.214.131.1 & ICMP & Internet & Echo Request\\
			\hline
			4 & C2:FD:5A:E8:60:E5 & EF:36:DE:39:06:86 & 194.214.131.1 & 192.168.0.2 & ICMP & Internet & Echo Reply\\
			\hline
			  & & & \vdots & & & \\
			  \hline
			10 & C2:FD:5A:E8:60:E5 & EF:36:DE:39:06:86 & 194.214.131.1 & 192.168.0.2 & ICMP & Internet & Echo Reply\\
			\hline
		\end{tabular}
	}
		\caption{Échanges de trames entre \texttt{PC2} et routeur}
	\end{figure}
	
	\begin{figure}[!ht]
		\centering
		\adjustbox{width=\textwidth}{
		\begin{tabular}{|l|l|l|l|l|l|l|l|}
			\hline
			No. & MAC Destination & MAC Source & IP Source & IP Destination & Protocole & Couche & Commentaire\\
			\hline
			1 & FF:FF:FF:FF:FF:FF & C1:47:C8:46:37:06 & 194.214.131.254 & 194.214.131.1 & ARP & Internet & Requête ARP\\
			\hline
			2 & C1:47:C8:46:37:06 & 8B:61:E6:30:57:33 & 194.214.131.1 & 194.214.131.254 & ARP & Internet & Réponse ARP\\
			\hline
			3 & E8:36:DE:39:06:86 & C1:47:C8:46:37:06 & 192.168.0.2 & 194.214.131.1 & ICMP & Internet & Echo Request\\
			\hline
			4 & C1:47:C8:46:37:06 & 8B:61:E6:30:57:33 & 194.214.131.1 & 192.168.0.2 & ICMP & Internet & Echo Reply\\
			\hline
			  & & & \vdots & & & \\
			  \hline
			10 & C1:47:C8:46:37:06 & 8B:61:E6:30:57:33 & 194.214.131.1 & 192.168.0.2 & ICMP & Internet & Echo Reply\\
			\hline
		\end{tabular}
	}
		\caption{Échanges de trames entre portable et routeur}
	\end{figure}

	Entre le \texttt{PC2} et le routeur on voit qu'il y a d'abord un requête ARP pour obtenir l'adresse MAC du routeur. Après l'avoir reçue il envoi un ping au portable mais avec une adresse MAC de destination du routeur. Lorsque le ping revient, c'est toujours l'adresse MAC du routeur qui est l'adresse source. 

	Quand on regarde avec les échanges entre le routeur et le portable on observe que la même chose se passe. Après une requête et une réponse ARP, le ping est envoyé avec l'adresse MAC du routeur et la destination de pong l'est aussi. 

	Le routeur agit donc comme un pont en se faisant passer par la machine mais en utilisant sa propre adresse MAC. 

	\section{Mise en oeuvre d'un DNS}

	Un serveur DNS permet d'associer un URL à une adresse IP, c'est à base de traduction.

	L'option "activer la résolution recursive de domaine" permet d'accéder à d'autre sites web en contactant d'autre serveur DNS, de cette façon on ne doit pas se reposer sur un unique serveur DNS. 
	
	\begin{figure}[ht!]
		\centering
		\includegraphics[width=0.7\textwidth]{./object/t2.png}
		\caption{Trames échangés}
	\end{figure}

	On constate qu'avant d'accéder au domaine il y a une demande au serveur DNS pour obtenir l'adresse IP du site, et ensuite le serveur répond avec l'IP du site. 

	Le protocole RIP consiste à ce que chaque routeur envoi sa table de routage au prochain, ceci permet d'optimiser le routage dans des réseaux complexes avec plusieurs routeur.

	Q18. La trame est un broadcast dans lequel est contenu l'IP du routeur et l'IP des autres machine auquel il est connecté 

	Si R11 est coupé alors les trames devrons prendre un chemin plus long pour arriver à leur déstinataires. 


\end{document}
